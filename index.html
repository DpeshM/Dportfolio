import React, { useState } from 'react';
import { Calendar, Mail, User, FileText, Clock } from 'lucide-react';

export default function LeaveRequestApp() {
  const employees = [
    'Surav Shrestha',
    'Dipesh Mishra',
    'Sudhanshu Acharya',
    'Kreesh Suwal',
    'Ankit J. Karki',
    'Prabin Shrestha',
    'Ram Hasda',
    'Binita Khatri',
    'Palistha Shakya',
    'Prakriti Adhikari',
    'Pravash Dhamala',
    'Anshu Upreti',
    'Mamata Karki',
    'Ritu Shahi',
    'Aayush Thapa',
    'Ruby Shah',
    'Aayam Limbu',
    'Krishna Shrestha',
    'Sagar Thapa',
    'Utsav Subedi',
    'Sarmila Dhungel',
    'Arya Pokhrel',
    'Rojan Shrestha',
    'Prasansha Bhusal',
    'Bishesh Shrestha'
  ];

  const teamLeads = [
    { name: 'Kreesh Suwal', email: 'kreesh@brandlogiq.net' },
    { name: 'Ritu Shahi', email: 'ritu@brandlogiq.net' },
    { name: 'Surav Shrestha', email: 'surav@brandlogiq.net' },
    { name: 'Aayam Limbu', email: 'aayam@brandlogiq.net' },
    { name: 'Sagar Thapa', email: 'finance@brandlogiq.net' },
    { name: 'CEO', email: 'ceo@brandlogiq.net' },
    { name: 'Dipesh Mishra', email: 'dipesh@brandlogiq.net' }
  ];

  const [formData, setFormData] = useState({
    employeeName: '',
    employeeEmail: '',
    teamLead: '',
    leaveType: 'annual',
    startDate: '',
    endDate: '',
    reason: '',
    totalDays: ''
  });

  const handleNameChange = (e) => {
    const name = e.target.value;
    setFormData(prev => ({
      ...prev,
      employeeName: name
    }));
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const calculateDays = () => {
    if (formData.startDate && formData.endDate) {
      const start = new Date(formData.startDate);
      const end = new Date(formData.endDate);
      const diffTime = Math.abs(end - start);
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
      setFormData(prev => ({ ...prev, totalDays: diffDays }));
    }
  };

  const handleSubmit = () => {
    if (!formData.employeeName || !formData.employeeEmail || !formData.teamLead ||
        !formData.startDate || !formData.endDate || !formData.reason) {
      alert('Please fill in all required fields');
      return;
    }

    if (!formData.employeeEmail.endsWith('@brandlogiq.net')) {
      alert('Please use a valid @brandlogiq.net email address');
      return;
    }
    
    const hrEmail = 'hr@brandlogiq.net';
    const selectedLead = teamLeads.find(lead => lead.name === formData.teamLead);
    const ccEmail = selectedLead ? selectedLead.email : '';
    
    const subject = `Leave Request - ${formData.employeeName} (${formData.startDate} to ${formData.endDate})`;
    
    const body = `Dear HR Team,

I would like to request a leave of absence with the following details:

Employee Name: ${formData.employeeName}
Employee Email: ${formData.employeeEmail}
Team Lead: ${formData.teamLead}
Leave Type: ${formData.leaveType.charAt(0).toUpperCase() + formData.leaveType.slice(1)} Leave
Start Date: ${formData.startDate}
End Date: ${formData.endDate}
Total Days: ${formData.totalDays} day(s)

Reason for Leave:
${formData.reason}

I would appreciate your approval for this leave request at your earliest convenience.

Thank you for your consideration.

Best regards,
${formData.employeeName}`;

    const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${hrEmail}&cc=${ccEmail}&su=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    
    window.open(gmailUrl, '_blank');
    
    // Clear all fields after submission
    setFormData({
      employeeName: '',
      employeeEmail: '',
      teamLead: '',
      leaveType: 'annual',
      startDate: '',
      endDate: '',
      reason: '',
      totalDays: ''
    });
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-red-50 to-gray-100 py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-3xl mx-auto">
        <div className="bg-white rounded-2xl shadow-xl overflow-hidden">
          {/* Header */}
          <div className="bg-gradient-to-r from-red-600 to-red-700 px-8 py-6">
            <div className="flex items-center space-x-3">
              <Mail className="w-8 h-8 text-white" />
              <h1 className="text-3xl font-bold text-white">Leave Request System</h1>
            </div>
            <p className="text-red-100 mt-2">Submit your leave request to HR</p>
          </div>

          {/* Form */}
          <div className="px-8 py-6 space-y-6">
            {/* Employee Name Dropdown */}
            <div>
              <label className="flex items-center text-sm font-semibold text-gray-700 mb-2">
                <User className="w-4 h-4 mr-2 text-red-600" />
                Employee Name *
              </label>
              <select
                name="employeeName"
                value={formData.employeeName}
                onChange={handleNameChange}
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition bg-white"
              >
                <option value="">Select your name</option>
                {employees.map((name) => (
                  <option key={name} value={name}>
                    {name}
                  </option>
                ))}
              </select>
            </div>

            {/* Employee Email */}
            <div>
              <label className="flex items-center text-sm font-semibold text-gray-700 mb-2">
                <Mail className="w-4 h-4 mr-2 text-red-600" />
                Employee Email *
              </label>
              <div className="flex items-center">
                <input
                  type="text"
                  name="emailPrefix"
                  value={formData.employeeEmail.replace('@brandlogiq.net', '')}
                  onChange={(e) => {
                    const prefix = e.target.value.replace('@brandlogiq.net', '');
                    setFormData(prev => ({
                      ...prev,
                      employeeEmail: prefix + '@brandlogiq.net'
                    }));
                  }}
                  className="w-full px-4 py-3 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition"
                  placeholder="yourname"
                />
                <span className="px-4 py-3 bg-gray-100 border border-l-0 border-gray-300 rounded-r-lg text-gray-700 font-medium">
                  @brandlogiq.net
                </span>
              </div>
            </div>

            {/* Team Lead */}
            <div>
              <label className="flex items-center text-sm font-semibold text-gray-700 mb-2">
                <User className="w-4 h-4 mr-2 text-red-600" />
                Team Lead *
              </label>
              <select
                name="teamLead"
                value={formData.teamLead}
                onChange={handleChange}
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition bg-white"
              >
                <option value="">Select your team lead</option>
                {teamLeads.map((lead) => (
                  <option key={lead.email} value={lead.name}>
                    {lead.name}
                  </option>
                ))}
              </select>
              {formData.teamLead && (
                <p className="text-sm text-gray-500 mt-1">
                  CC: {teamLeads.find(lead => lead.name === formData.teamLead)?.email}
                </p>
              )}
            </div>

            {/* Leave Type */}
            <div>
              <label className="flex items-center text-sm font-semibold text-gray-700 mb-2">
                <FileText className="w-4 h-4 mr-2 text-red-600" />
                Leave Type *
              </label>
              <select
                name="leaveType"
                value={formData.leaveType}
                onChange={handleChange}
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition bg-white"
              >
                <option value="annual">Annual Leave</option>
                <option value="sick">Sick Leave</option>
                <option value="personal">Personal Leave</option>
                <option value="emergency">Emergency Leave</option>
                <option value="unpaid">Unpaid Leave</option>
              </select>
            </div>

            {/* Date Range */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="flex items-center text-sm font-semibold text-gray-700 mb-2">
                  <Calendar className="w-4 h-4 mr-2 text-red-600" />
                  Start Date *
                </label>
                <input
                  type="date"
                  name="startDate"
                  value={formData.startDate}
                  onChange={handleChange}
                  onBlur={calculateDays}
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition"
                />
              </div>
              <div>
                <label className="flex items-center text-sm font-semibold text-gray-700 mb-2">
                  <Calendar className="w-4 h-4 mr-2 text-red-600" />
                  End Date *
                </label>
                <input
                  type="date"
                  name="endDate"
                  value={formData.endDate}
                  onChange={handleChange}
                  onBlur={calculateDays}
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition"
                />
              </div>
            </div>

            {/* Total Days Display */}
            {formData.totalDays && (
              <div className="bg-red-50 border border-red-200 rounded-lg px-4 py-3">
                <div className="flex items-center">
                  <Clock className="w-5 h-5 text-red-600 mr-2" />
                  <span className="text-red-800 font-semibold">
                    Total Days: {formData.totalDays} day(s)
                  </span>
                </div>
              </div>
            )}

            {/* Reason */}
            <div>
              <label className="flex items-center text-sm font-semibold text-gray-700 mb-2">
                <FileText className="w-4 h-4 mr-2 text-red-600" />
                Reason for Leave *
              </label>
              <textarea
                name="reason"
                value={formData.reason}
                onChange={handleChange}
                rows="4"
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition resize-none"
                placeholder="Please provide details about your leave request..."
              />
            </div>

            {/* Submit Button */}
            <div className="pt-4">
              <button
                onClick={handleSubmit}
                className="w-full bg-gradient-to-r from-red-600 to-red-700 text-white font-semibold py-4 rounded-lg hover:from-red-700 hover:to-red-800 transform hover:scale-[1.02] transition duration-200 shadow-lg flex items-center justify-center space-x-2"
              >
                <Mail className="w-5 h-5" />
                <span>Send Leave Request to HR</span>
              </button>
              <p className="text-sm text-gray-500 text-center mt-3">
                Clicking this button will open Gmail with a pre-filled email to hr@brandlogiq.net
              </p>
            </div>
          </div>
        </div>

        {/* Info Box */}
        <div className="mt-6 bg-white rounded-lg shadow-md p-6">
          <h2 className="text-lg font-semibold text-gray-800 mb-3">How it works:</h2>
          <ol className="space-y-2 text-gray-600">
            <li className="flex items-start">
              <span className="font-bold text-red-600 mr-2">1.</span>
              Select your name from the dropdown list
            </li>
            <li className="flex items-start">
              <span className="font-bold text-red-600 mr-2">2.</span>
              Enter your email prefix (the part before @brandlogiq.net)
            </li>
            <li className="flex items-start">
              <span className="font-bold text-red-600 mr-2">3.</span>
              Select your team lead (they will be CC'd on the email)
            </li>
            <li className="flex items-start">
              <span className="font-bold text-red-600 mr-2">4.</span>
              Fill out the leave details and click "Send Leave Request to HR"
            </li>
            <li className="flex items-start">
              <span className="font-bold text-red-600 mr-2">5.</span>
              Gmail will open with a pre-filled email ready to send
            </li>
          </ol>
        </div>
      </div>
    </div>
  );
}
